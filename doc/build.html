<html>
<head>
<title>AdvanceMAME Build Notes</title>
</head>
<body>
<center><h2>AdvanceMAME Build Notes</h2></center>
<p>
This file contains the instructions to build AdvanceMAME,
AdvanceMESS and AdvanceMENU from the source archives.
<p>The sections of this document are:<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2">
<tr><td width="5%"></td><td colspan=3>
<a href="#1">1 Preparing The Sources</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#1.1">1.1 AdvanceMAME</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#1.2">1.2 AdvanceMESS</a><br>
</td></tr>
<tr><td width="5%"></td><td colspan=3>
<a href="#2">2 Configuring</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#2.1">2.1 Linux/Mac OS X/Generic Unix</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#2.2">2.2 DOS/Windows</a><br>
</td></tr>
<tr><td width="5%"></td><td colspan=3>
<a href="#3">3 Compiling</a><br>
</td></tr>
<tr><td width="5%"></td><td colspan=3>
<a href="#4">4 Installing</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#4.1">4.1 Linux/Mac OS X/Generic Unix</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#4.2">4.2 DOS/Windows</a><br>
</td></tr>
<tr><td width="5%"></td><td colspan=3>
<a href="#5">5 Requirements</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#5.1">5.1 Linux</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#5.2">5.2 Mac OS X</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#5.3">5.3 DOS</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#5.4">5.4 Windows</a><br>
</td></tr>
<tr><td width="5%"></td><td width="5%"></td><td colspan=2>
<a href="#5.5">5.5 Generic Unix</a><br>
</td></tr>
<tr><td width="5%"></td><td colspan=3>
<a href="#6">6 Debugging</a><br>
</td></tr>
<tr><td width="5%"></td><td colspan=3>
<a href="#7">7 Copyright</a><br>
</td></tr>
</table>
<h2><a name="1">1</a> 
Preparing The Sources
</h2>
If you are using the standard source packages you don't need
to prepare the sources, and you can go directly to
the `Configuring' chapter.
<p>
Instead, if you are using one of the `diff' source package
you need to complete the sources with the original emulator
source.
<h3><a name="1.1">1.1</a> 
AdvanceMAME
</h3>
To compile AdvanceMAME you need the MAME source of the same
version of AdvanceMAME. Please note that you must use the original emulator
source, you cannot use the source of another MAME clone like xmame.
<p>
The original MAME sources can be downloaded from:
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<a href="http://www.mame.net/">http://www.mame.net/</a>
<br>
</td></tr></table>
<p>
To complete the source you need to unzip the original MAME archive
in a different directory and copy some files in the AdvanceMAME
tree at the same level of the `advance/' directory.
<p>
In Linux and Mac OS X remember to unzip the original .zip archives
with the `unzip -aa' command to convert the files from the
DOS/Windows CR/LF format to the Unix CR format.
<p>
After unzipping you must:
<ul>
<li>
Copy the `src/' directory from the MAME archive in the AdvanceMAME tree.
</li>
</ul>
<p>
Please note that only the `src/' directory from the
MAME source is required, all the other files must be deleted.
<p>
The final directory tree for AdvanceMAME must be :
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
advance/advance.mak
src/mame.mak
</pre>
</td></tr></table>
<p>
After unpacked, you need to patch the original MAME source in
the `src/' directory with the patch `advance/advmame.dif'.
If the patch isn't applied correctly, probably you are using the wrong
version of the emulator source.
<p>
The commands for patching the source for AdvanceMAME in DOS and Windows are :
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
cd src
patch -p1 &lt; ..\advance\advmame.dif
</pre>
</td></tr></table>
<p>
and in Linux and Mac OS X are :
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
cd src
patch -p1 &lt; ../advance/advmame.dif
</pre>
</td></tr></table>
<h3><a name="1.2">1.2</a> 
AdvanceMESS
</h3>
To compile AdvanceMESS you need the MAME and MESS source of
the same version of AdvanceMESS. Please note that you must use the
original emulator source, you cannot use the source of another MAME
clone like xmame.
<p>
The original MAME sources can be downloaded from:
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<a href="http://www.mame.net/">http://www.mame.net/</a>
<br>
</td></tr></table>
<p>
The original MESS sources can be downloaded from:
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<a href="http://www.mess.org/">http://www.mess.org/</a>
<br>
</td></tr></table>
<p>
To complete the source you need to unzip the original MAME and MESS
archives in different directories and copy some files
in the AdvanceMAME tree at the same level of the `advance/' directory.
<p>
In Linux and Mac OS X remember to unzip the original .zip archives
with the `unzip -aa' command to convert the files from the
DOS/Windows CR/LF format to the Unix CR format.
<p>
After unzipping you must:
<ul>
<li>
Copy the `src/' directory from the MAME archive renaming it `srcmess/'.
</li>
<li>
Copy the `src/' directory from the MESS archive renaming it `srcmess/'
overwriting any file already present in the MAME archive.
</li>
<li>
Copy the `mess/' directory from the MESS archive.
</li>
</ul>
<p>
Please note that only the specified directories from the
MAME and MESS source are required, all the other files must be deleted.
<p>
The final directory tree for AdvanceMESS must be :
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
advance/advance.mak
srcmess/mame.mak
mess/mess.mak
</pre>
</td></tr></table>
<p>
After unpacked, you need to patch the original MESS source in
in the `srcmess/' directory with the patch `advance/advmess.dif' and
the source in the `mess/' directory with the patch `advance/mess.dif'.
If the patches aren't applied correctly, probably you are using the wrong
version of the emulator source.
<p>
The commands for patching the source for AdvanceMESS in DOS and Windows are :
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
cd srcmess
patch -p1 &lt; ..\advance\advmess.dif
cd ..\mess
patch -p1 &lt; ..\advance\mess.dif
</pre>
</td></tr></table>
<p>
and in Linux and Mac OS X are :
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
cd srcmess
patch -p1 &lt; ../advance/advmess.dif
cd ../mess
patch -p1 &lt; ../advance/mess.dif
</pre>
</td></tr></table>
<h2><a name="2">2</a> 
Configuring
</h2>
<h3><a name="2.1">2.1</a> 
Linux/Mac OS X/Generic Unix
</h3>
Run the `./configure' script.
<p>
Generally no extra option is required. You can get the complete
option list with the `./configure --help' command.
<p>
The default installation prefix is /usr/local. You can change it
with the `--prefix=' option.
<p>
The default host configuration directory is /usr/local/etc. You can
change it with the `--sysconfdir=' option. Please note that instead
of /usr/etc is always used /etc.
<p>
The configure script automatically detects all the available
libraries and the optimization flags. You can use the
--with-sdl-prefix option to search for the SDL library in a
specific location.
<p>
If you want to customize the compilation CFLAGS and LDFLAGS you
can put them on the ./configure command line.
<p>
For example for high optimization on Pentium4:
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
./configure CFLAGS="-O3 -march=pentium4 -fomit-frame-pointer" \
&nbsp;&nbsp;&nbsp;&nbsp;LDFLAGS="-s"
</pre>
</td></tr></table>
<p>
If you have the "Intel C Compiler 8" you can try with the
command:
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
./configure CC=icc CFLAGS="-I/usr/local/include -O3 -march=pentium4" \
&nbsp;&nbsp;&nbsp;&nbsp;LDFLAGS="-lsvml"
</pre>
</td></tr></table>
<p>
If you want to use the included version of the zlib and expat
libraries instead of the system version you must specify
the --disable-zlib and --disable-expat options.
<h3><a name="2.2">2.2</a> 
DOS/Windows
</h3>
In DOS/Windows you need to manually copy the `Makefile.usr'
file as `Makefile' and edit the first section to match your
requirements.
<p>
Read the file comments for major details.
<h2><a name="3">3</a> 
Compiling
</h2>
To compile run `make'.
<h2><a name="4">4</a> 
Installing
</h2>
<h3><a name="4.1">4.1</a> 
Linux/Mac OS X/Generic Unix
</h3>
Run `make install' to install the binaries and the documentation.
<p>
The binaries are installed in $prefix/bin, the program data
files in $prefix/share/advance, the documentation in
$prefix/share/doc/advance, and the man pages in $prefix/man/man1.
<p>
The default installation $prefix is /usr/local.
<p>
In Mac OS X please check that the directory $prefix/bin is in the
search PATH. Generally /usr/local/bin isn't.
<h3><a name="4.2">4.2</a> 
DOS/Windows
</h3>
Copy manually the compiled executables in a directory of your
choice.
<h2><a name="5">5</a> 
Requirements
</h2>
To compile AdvanceMAME you need at least 128 Mbyte of memory,
256 Mbyte are suggested.
<h3><a name="5.1">5.1</a> 
Linux
</h3>
To build in Linux you need the following software:
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
Linux 2.4.0 (or newer)
GNU gcc C/C++ 3.2.3 or 3.3.4 (or newer)
GNU make 3.79.1 (or newer)
</pre>
</td></tr></table>
<p>
The following software is also used if present:
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
NASM 0.98.33 (or newer)
SVGALIB 1.9.14 (or newer)
SDL 1.2.4 (or newer)
S-Lang 1.4.3 (or newer)
ncurses 5.4 (or newer)
FreeType 2.1.7 (or newer)
zlib 1.1.4 (or newer)
expat 1.95.6 (or newer)
</pre>
</td></tr></table>
<p>
The suggested gcc compiler versions are 3.2.3 and 3.3.4.
The versions 2.96.x, 3.0.x don't work. Other versions should work.
<p>
The SVGALIB 1.4.x versions are NOT supported. Download the latest
ALPHA 1.9.x or 2.0.x version from <a href="http://www.svgalib.org/">http://www.svgalib.org/</a>.
In the contrib/svgalib directory there are some source patches to
fix some problems of the library.
Remember to edit the /etc/vga/libvga.conf file with your settings.
Specifically you need at least to set correctly `HorizSync' and
`VertRefresh'.
<p>
If your distribution doesn't contain the S-Lang library you
can download it from <a href="http://www.s-lang.org/">http://www.s-lang.org/</a>.
<h3><a name="5.2">5.2</a> 
Mac OS X
</h3>
To build in Mac OS X and other Unix you need the following
software:
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
GNU gcc C/C++ 3.2.3 (or newer)
GNU make 3.79.1 (or newer)
SDL 1.2.4 (or newer)
</pre>
</td></tr></table>
<p>
The following software is also used if present:
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
FreeType 2.1.7 (or newer)
zlib 1.1.4 (or newer)
expat 1.95.6 (or newer)
</pre>
</td></tr></table>
<p>
The gcc compiler and make program are included in the Apple
Development Kit which must be installed manually from the
original Mac OS X cd.
<p>
The SDL library must be manually compiled and installed.
<p>
Please note that you may need to use the --with-sdl-prefix option
of the ./configure script to correctly find the installed SDL
library. Generally "./configure --with-sdl-prefix=/usr/local" is
enough.
<h3><a name="5.3">5.3</a> 
DOS
</h3>
To build in DOS you need the following software:
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
DJGPP development kit 2.03 (or never) [djdev*.zip]
DJGPP GNU gcc C/C++ 3.2.3 or 3.3.4 [gcc*b.zip gpp*b.zip]
DJGPP GNU make 3.79.1 (or newer) [mak*b.zip]
DJGPP GNU binutils [bnu*b.zip]
DJGPP GNU fileutils [fil*b.zip]
DJGPP GNU shellutils [shl*b.zip]
DJGPP GNU patch [pat*b.zip]
NASM 0.98.33 (or newer)
Allegro 4.0.0 (or newer)
SEAL 1.0.7 + MAME patch
FreeType 2.1.7 (or newer)
</pre>
</td></tr></table>
<p>
The suggested gcc compiler versions are 3.2.3 and 3.3.4.
The versions 3.0.x don't work. The version 3.4.x may have some
problems related to the new "unit-at-a-time" compilation,
don't use it, or disable this feature with the option
-fnounit-at-a-time. Other versions should work.
<p>
The patched SEAL library is available at <a href="http://www.mame.net/">http://www.mame.net/</a>.
<p>
Ensure to have the DOS version of NASM. If you have the Windows
version named `nasmw.exe' you must rename it as `nasm.exe' or
change the `Makefile.usr' to use it.
<p>
If compiling you get the "Argument list too long" error,
or "Error -1" you need to use the DJGPP stubedit utility
to increase bufsize value for some DJGPP tools, with the
following commands:
<p>
<pre>
stubedit c:\djgpp\bin\gcc.exe bufsize=32k
stubedit c:\djgpp\bin\ld.exe bufsize=32k
stubedit c:\djgpp\bin\make.exe bufsize=32k
stubedit c:\djgpp\lib\gcc-lib\djgpp\3.23\collect2.exe bufsize=32k
</pre>
<p>
You may need to use different paths to the files,
especially for collect2.exe.
<h3><a name="5.4">5.4</a> 
Windows
</h3>
To build in Windows you need the following software:
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
MINGW 1.1 (or newer)
MINGW GNU gcc C/C++ 3.2.3 (or never)
NASM 0.98.33 (or newer)
SDL 1.2.4 (or newer)
FreeType 2.1.7 (or newer)
</pre>
</td></tr></table>
<p>
The only tested compiler version is 3.2.3. Other versions
should work.
<h3><a name="5.5">5.5</a> 
Generic Unix
</h3>
To build in a generic Unix environment you need the following
software:
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
GNU gcc C/C++ 3.2.3 (or newer)
GNU make 3.79.1 (or newer)
SDL 1.2.4 (or newer)
</pre>
</td></tr></table>
<p>
The following software is also used if present:
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
zlib 1.1.4 (or newer)
expat 1.95.6 (or newer)
</pre>
</td></tr></table>
<h2><a name="6">6</a> 
Debugging
</h2>
To debug the program the suggested configuration options
are:
<p>
<table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td width="5%"></td><td width="95%">
<pre>
./configure --enable-debug --disable-svgalib \
&nbsp;&nbsp;&nbsp;&nbsp;--disable-pthread
</pre>
</td></tr></table>
<p>
The svgalib library is disabled because it interferes with
the stack backtrace on the signal handler.
<p>
The pthread library is disabled because it interferes with
the debugger signals.
<p>
The suggested environment is X Window using the SDL
library. This allow to run the debugger and the programs
on the same monitor and keyboard.
<h2><a name="7">7</a> 
Copyright
</h2>
This file is Copyright (C) 2003, 2004 Andrea Mazzoleni.
</body>
</html>
